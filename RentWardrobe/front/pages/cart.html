<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8" />
    <title>RentWardrobe - Кошик</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" />
    <link rel="stylesheet" href="../styles/cart.css" />
    <script>
        if (!localStorage.getItem('currentUserEmail')) {
            window.location.href = 'auth.html';
        }
    </script>
</head>
<body>
<div class="top-message">
    <span>YOUR PERFECT PROM LOOKS STARTS HERE</span>
    <span>YOUR PERFECT PROM LOOKS STARTS HERE</span>
    <span>YOUR PERFECT PROM LOOKS STARTS HERE</span>
</div>
<header>
    <a href="index.html" style="color: inherit; text-decoration: none;">
        <div class="logo">RentWardrobe</div>
    </a>
    <nav class="menu">
        <ul>
            <li><a href="#">Жіночий</a></li>
            <li><a href="#">Чоловічий</a></li>
            <li><a href="#">Пошук</a></li>
            <li><a href="#">Особистий кабінет</a></li>
        </ul>
    </nav>
    <div class="header-icons">
        <a href="cart.html">
            <i class="fa-solid fa-cart-shopping"></i>
        </a>
        <a href="userProfile.html">
            <i class="fa-solid fa-user"></i>
        </a>
    </div>
</header>
<div class="cart-container">
    <div class="breadcrumbs">
        <a href="#">RentWardrobe</a> / <span>Кошик</span>
    </div>

    <h2 class="cart-title">МІЙ КОШИК</h2>
    <div id="cartItemsContainer"></div>
    <div class="cart-bottom">
        <button class="checkout-btn" onclick="window.location.href='checkout.html'">Оформити замовлення</button>
        <div class="cart-total">
            <span>Всього</span>
            <strong id="totalPrice">0 грн</strong>
        </div>
    </div>
</div>
<script>
    function renderCartItems() {
        const cartItemsContainer = document.getElementById('cartItemsContainer');
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        cartItemsContainer.innerHTML = "";
        let totalRentSum = 0;
        cart.forEach((item, index) => {
            const buyPrice = item.price || "";
            const rentPricePerDay = parseFloat(item.rentPrice.replace(/\D/g, "")) || 0;
            const days = item.quantity;
            const totalRentForItem = rentPricePerDay * days;
            totalRentSum += totalRentForItem;
            let sizeSelectorHTML = "";
            if (item.sizes && Array.isArray(item.sizes)) {
                sizeSelectorHTML = `<select class="size-dropdown" data-index="${index}">
              ${item.sizes.map(sizeValue => {
                    const selected = (sizeValue === item.size) ? "selected" : "";
                    return `<option value="${sizeValue}" ${selected}>${sizeValue}</option>`;
                }).join("")}
            </select>`;
            } else {
                sizeSelectorHTML = `<span>${item.size || "N/A"}</span>`;
            }
            const itemDiv = document.createElement("div");
            itemDiv.className = "cart-item";
            itemDiv.innerHTML = `
          <div class="item-image">
            <img src="${item.img}" alt="${item.title}" />
          </div>
          <div class="item-right">
            <div class="item-upper">
              <div class="item-quantity">
                <span>Кількість днів оренди:</span>
                <input type="number" value="${days}" min="1" data-index="${index}" class="quantity-input" />
              </div>
              <div class="item-total-price">
                <span>Вартість оренди:</span>
                <strong>${totalRentForItem} грн</strong>
              </div>
              <button class="delete-item-btn" data-index="${index}" title="Видалити">
                <i class="fa-solid fa-trash"></i>
              </button>
            </div>
            <div class="item-details">
              <p class="item-name">${item.title}</p>
              ${buyPrice ? `<p class="item-full-price">Повна ціна: ${buyPrice}</p>` : ""}
              <div class="item-size">
                <span>Розмір:</span> ${sizeSelectorHTML}
              </div>
              <p class="item-rent-price">Оренда за добу: ${item.rentPrice}</p>
              <p class="item-rating">Рейтинг: ${item.rating || "N/A"}</p>
            </div>
          </div>
        `;
            cartItemsContainer.appendChild(itemDiv);
        });
        document.getElementById("totalPrice").textContent = totalRentSum + " грн";
        attachDeleteEvent();
        attachQuantityChangeEvent();
        attachDropdownChangeEvent();
    }
    function attachDeleteEvent() {
        const deleteButtons = document.querySelectorAll(".delete-item-btn");
        deleteButtons.forEach(button => {
            button.addEventListener("click", function () {
                const index = this.getAttribute("data-index");
                let cart = JSON.parse(localStorage.getItem("cart")) || [];
                cart.splice(index, 1);
                localStorage.setItem("cart", JSON.stringify(cart));
                renderCartItems();
            });
        });
    }
    function attachQuantityChangeEvent() {
        const quantityInputs = document.querySelectorAll(".quantity-input");
        quantityInputs.forEach(input => {
            input.addEventListener("change", function () {
                const newQuantity = parseInt(this.value);
                const index = this.getAttribute("data-index");
                let cart = JSON.parse(localStorage.getItem("cart")) || [];
                if (newQuantity < 1) {
                    this.value = cart[index].quantity;
                    return;
                }
                cart[index].quantity = newQuantity;
                localStorage.setItem("cart", JSON.stringify(cart));
                renderCartItems();
            });
        });
    }
    function attachDropdownChangeEvent() {
        const dropdowns = document.querySelectorAll(".size-dropdown");
        dropdowns.forEach(dropdown => {
            dropdown.addEventListener("change", function () {
                const index = this.getAttribute("data-index");
                const selectedSize = this.value;
                let cart = JSON.parse(localStorage.getItem("cart")) || [];
                cart[index].size = selectedSize;
                localStorage.setItem("cart", JSON.stringify(cart));
                renderCartItems();
            });
        });
    }

    renderCartItems();
</script>
</body>
</html>










