<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>RentWardrobe - Історія замовлень</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="../styles/userProfile.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" />
  <script>
    if (!localStorage.getItem('currentUserEmail')) {
      window.location.href = 'auth.html';
    }
  </script>
</head>
<body>
<div class="top-message">
  <span>YOUR PERFECT PROM LOOKS STARTS HERE</span>
  <span>YOUR PERFECT PROM LOOKS STARTS HERE</span>
  <span>YOUR PERFECT PROM LOOKS STARTS HERE</span>
</div>
<header>
  <a href="index.html" style="color: inherit; text-decoration: none;">
    <div class="logo">RentWardrobe</div>
  </a>
  <nav class="menu">
    <ul>
      <li><a href="#">Жіночий</a></li>
      <li><a href="#">Чоловічий</a></li>
      <li><a href="#">Пошук</a></li>
      <li><a href="userProfile.html">Особистий кабінет</a></li>
    </ul>
  </nav>
  <div class="header-icons">
    <a href="cart.html"><i class="fa-solid fa-cart-shopping"></i></a>
    <a href="userProfile.html"><i class="fa-solid fa-user"></i></a>
  </div>
</header>
<div class="cabinet-container">
  <h2 class="cabinet-title">ІСТОРІЯ ЗАМОВЛЕНЬ</h2>
  <div class="orders-list" id="ordersList"></div>
</div>

<!-- Сюди вставте код для завантаження замовлень через сесію -->
<script>
  async function loadOrdersFromSession() {
    try {
      // Надсилаємо запит до серверного ендпоінту, який повертає замовлення, збережені в сесії
      const res = await fetch('/api/orders');
      const ordersHistory = await res.json();
      const currentUserEmail = localStorage.getItem('currentUserEmail');
      // Фільтруємо замовлення за email поточного користувача
      const filtered = ordersHistory.filter(order => order.email === currentUserEmail);
      const container = document.getElementById('ordersList');
      if (!filtered.length) {
        container.innerHTML = '<p>У вас ще немає замовлень.</p>';
        return;
      }
      container.innerHTML = "";
      filtered.forEach(order => {
        const div = document.createElement('div');
        div.className = 'order-card';
        div.innerHTML = `
            <h4>Замовлення №${order.id}</h4>
            <p><strong>Ім’я:</strong> ${order.name}</p>
            <p><strong>Телефон:</strong> ${order.phone}</p>
            <p><strong>Доставка:</strong> ${order.delivery} (${order.address})</p>
            <p><strong>Оплата:</strong> ${order.payment}</p>
            <p><strong>Коментар:</strong> ${order.comment || '-'}</p>
            <h5>Товари:</h5>
            <ul>
              ${order.cart.map(item => `<li>${item.title} — ${item.quantity} днів — ${item.rentPrice}</li>`).join('')}
            </ul>
          `;
        container.appendChild(div);
      });
    } catch (err) {
      console.error('Помилка при завантаженні замовлень:', err);
    }
  }

  window.onload = loadOrdersFromSession;
</script>
</body>
</html>

